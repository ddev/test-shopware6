const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C5H1QfDX.js","assets/index-D9lDzHRE.css","assets/index-CRvZpqS8.js","assets/index-DGBsDSla.css","assets/index-D5o0j6kg.js","assets/index-8LRsC7Gr.css","assets/index-DXBm-pWW.js","assets/index-BfYnF1XK.css","assets/index-CbEpgJrF.js","assets/index-CbJ5uoJV.css","assets/index-QGuQWuIX.js","assets/index-D_hK5z0f.css","assets/index-BiVKHvoA.js","assets/index-CZdYCxXE.css","assets/index-CGtdHYTL.js","assets/index-BK68ErnY.css","assets/index-DccIB_Gs.js","assets/index-D6vjOMVZ.css","assets/index-CrbP2RUY.js","assets/index-B5PfroSC.css","assets/index-C9KwSF42.js","assets/main-FjIbc34h.js","assets/channel-DB_OaefQ.js","assets/administration-boSmrxN-.js","assets/administration-BrEEjA-6.css","assets/main-nbn0NAVs.css","assets/index-CvCOfDVR.css","assets/index-D8U1zwyH.js","assets/index-ybtBht3-.css","assets/index-Dq35dXMX.js","assets/index-CJq7z4OL.css","assets/index-AUPdPW-k.js","assets/index-BmnZrzAC.css","assets/index-DRuWy2H0.js","assets/index-YHVk0LUL.css","assets/index-CGJDKSST.js","assets/index-D5pDRlEV.css","assets/index-CvR4hORM.js","assets/index-BE3xEz5J.css","assets/index-B7XNkGXm.js","assets/index-DU1UURm3.css","assets/index-C6QNqVtQ.js","assets/index-BXuU9lP5.css","assets/index-BwPvtUH3.js","assets/index-49r1AyAS.css","assets/index-SPknUrKR.js","assets/index-CgA4Gdl7.css"])))=>i.map(i=>d[i]);
var u=Object.defineProperty;var h=(m,e,t)=>e in m?u(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t;var g=(m,e,t)=>h(m,typeof e!="symbol"?e+"":e,t);import{_ as p}from"./administration-boSmrxN-.js";import{A as _}from"./api.service-C8jZavFF.js";import"./channel-DB_OaefQ.js";class y extends _{constructor(t,r,i="import-export"){super(t,r,i);g(this,"onProgressStartedListener",[]);this.name="importExportService",this.httpClient=t}async export(t,r,i){const o=new Date;o.setDate(o.getDate()+30);const s=await this.httpClient.post("/_action/import-export/prepare",{profileId:t,config:i,expireDate:o.toDateString()},{headers:this.getBasicHeaders()});return this.trackProgress(s,r)}async getDownloadUrl(t){const r=await this.httpClient.post(`/_action/import-export/file/prepare-download/${t}`,{},{headers:this.getBasicHeaders()});return`${Shopware.Context.api.apiPath||""}/_action/${this.getApiBasePath()}/file/download?fileId=${t}&accessToken=${r.data.accessToken}`}async getTemplateFileDownloadUrl(t){const r=await this.httpClient.post(`/_action/import-export/prepare-template-file-download?profileId=${t}`,{},{headers:this.getBasicHeaders()});return`${Shopware.Context.api.apiPath||""}/_action/${this.getApiBasePath()}/file/download?fileId=${r.data.fileId}&accessToken=${r.data.accessToken}`}getMappingFromTemplate(t,r,i=";",o='"'){const s=new FormData;return s.append("file",t),s.append("sourceEntity",r),s.append("delimiter",i),s.append("enclosure",o),this.httpClient.post("/_action/import-export/mapping-from-template",s,{headers:this.getBasicHeaders({"Content-Type":"multipart/form-data"})}).then(n=>n.data?Promise.resolve(n.data):Promise.reject(new Error("Empty response data")))}async import(t,r,i,o={},s=!1){const n=new Date;n.setDate(n.getDate()+30);const a=new FormData;r&&a.append("file",r),a.append("profileId",t),a.append("expireDate",n.toDateString()),s&&a.append("dryRun","true"),Object.entries(o).forEach(([l,c])=>{a.append(`config[${l}]`,JSON.stringify(c))});const d=await this.httpClient.post("/_action/import-export/prepare",a,{headers:this.getBasicHeaders({"Content-Type":"multipart/form-data"})});return this.trackProgress(d,i)}async trackProgress(t,r){return await this.httpClient.post("/_action/import-export/process",{logId:t.data.log.id},{headers:this.getBasicHeaders()}),r.call(this,t.data.log),this.onProgressStartedListener.forEach(i=>{i.call(this)}),t}addOnProgressStartedListener(t){this.onProgressStartedListener.push(t)}cancel(t){return this.httpClient.post(`/_action/${this.getApiBasePath()}/cancel`,{logId:t},{headers:this.getBasicHeaders()}).then(_.handleResponse.bind(this))}}class f{constructor(e){this.EntityDefinition=e}validate(e,t,r=[],i=!1){const o=this.convertMappingKeys(t),s=this.convertMappingKeys(r),n=this.EntityDefinition.getRequiredFields(e);let a=[];if(Object.keys(n).forEach(d=>{d==="translations"||d==="price"||s.length>0&&!s.some(c=>d===c)||o.includes(d)||a.push(d)}),i){const l=this.EntityDefinition.get(e).getPrimaryKeyFields();a=a.filter(c=>l[c]!==void 0)}return{missingRequiredFields:a}}convertMappingKeys(e){const t=e.map(r=>r.key);return t.forEach(r=>{const i=r.split(".");i.includes("translations")&&t.push(i.slice(2).join(""));const o=r.split(".id");o.length===2&&i.length===2&&t.push(`${o[0]}Id`)}),t}getSystemRequiredFields(e,t=1){const r=this.EntityDefinition.get(e);return this._getSystemRequiredFieldsForEntityCreation(r,t)}_getSystemRequiredFieldsForEntityCreation(e,t=1,r="",i={}){let o={};return t<=0||i[e.getEntity()]!==void 0||r.endsWith("translations.DEFAULT.language.")||(i[e.getEntity()]=e.getEntity(),e.forEachField((s,n,a)=>{o={...o,...this._handleField(s,n,a,t,r,i)}})),o}_handleField(e,t,r,i,o,s){var d,l;let n={};if(e.type==="association"&&e.relation==="many_to_one"&&((l=(d=r[e.localField])==null?void 0:d.flags)==null?void 0:l.required)===!0)return n={...n,...this._handleAssociation(e,t,r,i,o,s)},n;if(e.flags.required!==!0||t==="createdAt"||t.toLowerCase().includes("versionid")||e.flags.translatable===!0||e.type==="uuid"&&t!=="id")return n;if(t==="translations"&&e.type==="association"&&e.flags.required===!0)return n={...n,...this._getSystemRequiredFieldsForEntityCreation(this.EntityDefinition.get(e.entity),i,`${o}${t}.DEFAULT.`,s)},n;if(t==="price"&&e.type==="json_object")return n={...n,...this._addPriceFields(o,t)},n;const a=`${o}${t}`;return n[a]=a,n}_handleAssociation(e,t,r,i,o,s){const n={},a=`${o}${t}.`;if(s[e.entity]===void 0&&!a.endsWith("translations.DEFAULT.language.")){const l=`${a}${e.referenceField}`;n[l]=l}const d=this._getSystemRequiredFieldsForEntityCreation(this.EntityDefinition.get(e.entity),i-1,a,s);return{...n,...d}}_addPriceFields(e,t){const r={},i=`${e}${t}.DEFAULT.net`;r[i]=i;const o=`${e}${t}.DEFAULT.gross`;return r[o]=o,r}}class w{constructor(e){this.EntityDefinition=e}getEntity(e,t){const r=t.split("."),i=[];let o=this.EntityDefinition.get(e),s=!1,n=null,a=o.entity;return r.forEach(d=>{const l=o.properties[d];if(!l||d==="translations")return;if(l.flags.runtime===!0){o={entity:null};return}const c=l.entity;s=this.EntityDefinition.has(c),s&&(o=this.EntityDefinition.get(c),i.push(d),n=l.relation,a=d)}),{entity:o.entity,path:i.join("."),relation:n,name:a}}getSelected(e,t){const r=this.EntityDefinition.get(e),i=Object.keys(r.getPrimaryKeyFields())[0];if(!Array.isArray(t))return i;const o=this.getUpdateByMappingByEntity(e,t);return o?o.mappedKey:i}updateMapping(e,t,r){if(!t){this.removeUpdateByMappingByEntity(r,e.updateBy);return}if(!Array.isArray(e.updateBy)){e.updateBy=[{entityName:r,mappedKey:t}];return}const i=this.getUpdateByMappingByEntity(r,e.updateBy);if(!i){e.updateBy.push({entityName:r,mappedKey:t});return}i.mappedKey=t}getUpdateByMappingByEntity(e,t){const r=t.filter(i=>i.entityName===e);return r.length?r[0]:null}removeUpdateByMappingByEntity(e,t){if(!Array.isArray(t))return;const r=this.getUpdateByMappingByEntity(e,t);if(!r)return;const i=t.indexOf(r);i>-1&&t.splice(i,1)}removeUnusedMappings(e){if(!e||!Array.isArray(e.updateBy))return;if(!Array.isArray(e.mapping)||!e.mapping.length){e.updateBy=[];return}const t={};e.mapping.forEach(i=>{const{entity:o,path:s,relation:n}=this.getEntity(e.sourceEntity,i.key);if(n==="many_to_many"){t[o]=!0;return}t.hasOwnProperty(o)||(t[o]=[]);const a=s!==""?i.key.replace(new RegExp(`^(${s}.)`),""):i.key;t[o].push(a)}),e.updateBy.filter(i=>!t.hasOwnProperty(i.entityName)||Array.isArray(t[i.entityName])&&!t[i.entityName].includes(i.mappedKey)).forEach(i=>{this.removeUpdateByMappingByEntity(i.entityName,e.updateBy)})}}Shopware.Service("privileges").addPrivilegeMappingEntry({category:"additional_permissions",parent:null,key:"system",roles:{import_export:{privileges:["import_export_log:read","import_export_file:read","import_export_file:create","import_export_file:update","user:read","import_export_profile:read","import_export_profile:create","import_export_profile:delete","currency:read"],dependencies:[]}}});Shopware.Service().register("importExport",()=>new y(Shopware.Application.getContainer("init").httpClient,Shopware.Service("loginService")));Shopware.Service().register("importExportProfileMapping",()=>new f(Shopware.EntityDefinition));Shopware.Service().register("importExportUpdateByMapping",()=>new w(Shopware.EntityDefinition));Shopware.Component.register("sw-import-export",()=>p(()=>import("./index-C5H1QfDX.js"),__vite__mapDeps([0,1])));Shopware.Component.register("sw-import-export-exporter",()=>p(()=>import("./index-CRvZpqS8.js"),__vite__mapDeps([2,3])));Shopware.Component.register("sw-import-export-importer",()=>p(()=>import("./index-D5o0j6kg.js"),__vite__mapDeps([4,5])));Shopware.Component.register("sw-import-export-activity",()=>p(()=>import("./index-DXBm-pWW.js"),__vite__mapDeps([6,7])));Shopware.Component.register("sw-import-export-activity-log-info-modal",()=>p(()=>import("./index-CbEpgJrF.js"),__vite__mapDeps([8,9])));Shopware.Component.register("sw-import-export-activity-result-modal",()=>p(()=>import("./index-QGuQWuIX.js"),__vite__mapDeps([10,11])));Shopware.Component.register("sw-import-export-edit-profile-modal",()=>p(()=>import("./index-BiVKHvoA.js"),__vite__mapDeps([12,13])));Shopware.Component.register("sw-import-export-edit-profile-modal-mapping",()=>p(()=>import("./index-CGtdHYTL.js"),__vite__mapDeps([14,15])));Shopware.Component.register("sw-import-export-edit-profile-modal-identifiers",()=>p(()=>import("./index-DccIB_Gs.js"),__vite__mapDeps([16,17])));Shopware.Component.register("sw-import-export-entity-path-select",()=>p(()=>import("./index-CrbP2RUY.js"),__vite__mapDeps([18,19])));Shopware.Component.register("sw-import-export-edit-profile-field-indicators",()=>p(()=>import("./index-C9KwSF42.js"),__vite__mapDeps([20,21,22,23,24,25,26])));Shopware.Component.register("sw-import-export-edit-profile-import-settings",()=>p(()=>import("./index-D8U1zwyH.js"),__vite__mapDeps([27,28])));Shopware.Component.register("sw-import-export-edit-profile-general",()=>p(()=>import("./index-Dq35dXMX.js"),__vite__mapDeps([29,21,22,23,24,25,30])));Shopware.Component.register("sw-import-export-new-profile-wizard",()=>p(()=>import("./index-AUPdPW-k.js"),__vite__mapDeps([31,32])));Shopware.Component.register("sw-import-export-new-profile-wizard-general-page",()=>p(()=>import("./index-DRuWy2H0.js"),__vite__mapDeps([33,22,34])));Shopware.Component.register("sw-import-export-new-profile-wizard-csv-page",()=>p(()=>import("./index-CGJDKSST.js"),__vite__mapDeps([35,36])));Shopware.Component.register("sw-import-export-new-profile-wizard-mapping-page",()=>p(()=>import("./index-CvR4hORM.js"),__vite__mapDeps([37,22,38])));Shopware.Component.register("sw-import-export-view-import",()=>p(()=>import("./index-B7XNkGXm.js"),__vite__mapDeps([39,40])));Shopware.Component.register("sw-import-export-view-export",()=>p(()=>import("./index-C6QNqVtQ.js"),__vite__mapDeps([41,42])));Shopware.Component.register("sw-import-export-view-profiles",()=>p(()=>import("./index-BwPvtUH3.js"),__vite__mapDeps([43,44])));Shopware.Component.register("sw-import-export-progress",()=>p(()=>import("./index-SPknUrKR.js"),__vite__mapDeps([45,46])));Shopware.Module.register("sw-import-export",{type:"core",name:"ImportExport",title:"sw-import-export.general.mainMenuItemGeneral",description:"sw-import-export.general.descriptionTextModule",version:"1.0.0",targetVersion:"1.0.0",color:"#9AA8B5",icon:"regular-cog",entity:"import_export_profile",routePrefixPath:"sw/import-export",routes:{index:{component:"sw-import-export",path:"index",meta:{parentPath:"sw.settings.index",privilege:"system.import_export"},redirect:{name:"sw.import.export.index.import"},children:{import:{component:"sw-import-export-view-import",path:"import",meta:{parentPath:"sw.settings.index",privilege:"system.import_export"}},export:{component:"sw-import-export-view-export",path:"export",meta:{parentPath:"sw.settings.index",privilege:"system.import_export"}},profiles:{component:"sw-import-export-view-profiles",path:"profiles",meta:{parentPath:"sw.settings.index",privilege:"system.import_export"}}}}},settingsItem:{group:"automation",to:"sw.import.export.index",icon:"regular-database",privilege:"system.import_export"}});
