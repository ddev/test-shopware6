const c=`{% block sw_product_detail_variants %} <div class="sw-product-detail-variants"> {% block sw_product_detail_variants_sw_card_generated_variants %} <mt-card class="sw-product-detail-variants__generated-variants" position-identifier="sw-product-detail-variants-generated-variants" :class="{'is--loading': isLoading}" :title="$tc('sw-product.variations.generatedVariationCardTitle')" large > <template v-if="!isLoading && propertiesAvailable" #tabs > <sw-tabs position-identifier="sw-variant-card-tabs" :small="false" :default-item="defaultTab" @new-item-active="setActiveTab($event.name)" > <sw-tabs-item name="all" :active-tab="activeTab" > {{ $tc('sw-product.variations.variationCard.tabs.allProducts') }} </sw-tabs-item> <sw-tabs-item name="is-physical" :active-tab="activeTab" > {{ $tc('sw-product.variations.variationCard.tabs.physicalProducts') }} </sw-tabs-item> <sw-tabs-item name="is-download" :active-tab="activeTab" > {{ $tc('sw-product.variations.variationCard.tabs.digitalProducts') }} </sw-tabs-item> </sw-tabs> </template> <sw-skeleton v-if="isLoading" /> {% block sw_product_detail_variants_sw_card_empty_state %} <mt-empty-state v-if="!isLoading && !propertiesAvailable" :icon="$route.meta.$module.icon" :headline="$tc('sw-product.variations.emptyStatePropertyTitle')" :description="$tc('sw-product.variations.emptyStatePropertyDescription')" > <template #button> {% block sw_product_properties_empty_state_button_property %} <mt-button v-tooltip="{ message: $tc('sw-privileges.tooltip.warning'), disabled: acl.can('product.editor'), showOnDisabledElements: true }" ghost :disabled="!acl.can('product.editor')" variant="secondary" @click="openAddPropertiesModal" > {{ $tc('sw-product.properties.buttonAddProperties') }} </mt-button> {% endblock %} </template> </mt-empty-state> {% endblock %} {% block sw_product_detail_variants_sw_card_generated_variants_overview %} <sw-product-variants-overview v-if="product.id" v-show="variantListHasContent && !isLoading" ref="generatedVariants" :product-states="currentProductStates" :groups="groups" :selected-groups="configSettingGroups" :product-entity="productEntity" @variants-finish-update="updateVariantListHasContent" @generator-open="openModal('variantGeneration')" @delivery-open="openModal('deliveryModal')" /> {% endblock %} {% block sw_product_detail_variants_sw_card_empty_state_variant %} <mt-empty-state v-if="!isLoading && propertiesAvailable && variants.length === 0" :icon="$route.meta.$module.icon" :headline="$tc('sw-product.variations.emptyStateTitle')" :description="$tc('sw-product.variations.emptyStateDescription')" > <template #button> {% block sw_product_properties_empty_state_button %} <mt-button v-tooltip="{ message: $tc('sw-privileges.tooltip.warning'), disabled: acl.can('product.creator'), showOnDisabledElements: true }" class="sw-product-detail-variants__generated-variants-empty-state-button" ghost :disabled="!acl.can('product.creator')" variant="secondary" @click="openModal('variantGeneration')" > {{ $tc('sw-product.variations.emptyStateButton') }} </mt-button> {% endblock %} </template> </mt-empty-state> {% endblock %} </mt-card> {% endblock %} {% block sw_product_detail_variants_modal_variant_generation %} <sw-product-modal-variant-generation v-if="activeModal === 'variantGeneration'" :product="productEntity" :groups="groups" :actual-status="activeTab" :selected-groups="configSettingGroups" @modal-close="activeModal = ''" @variations-finish-generate="updateVariations" /> {% endblock %} {% block sw_product_detail_variants_modal_delivery %} <sw-product-modal-delivery v-if="activeModal === 'deliveryModal'" :product="productEntity" :selected-groups="configSettingGroups" @configuration-close="onConfigurationClosed" @modal-close="activeModal = ''" /> {% endblock %} {% block sw_product_properties_add_properties_modal %} <sw-product-add-properties-modal v-if="showAddPropertiesModal" :new-properties="newProperties" @modal-cancel="onCancelAddPropertiesModal" @modal-save="onSaveAddPropertiesModal" /> {% endblock %} </div> {% endblock %}`,{Criteria:o,EntityCollection:l}=Shopware.Data,{uniqBy:u}=Shopware.Utils.array,{cloneDeep:h}=Shopware.Utils.object,g={template:c,inject:["repositoryFactory","acl"],data(){return{variantListHasContent:!1,activeModal:"",isLoading:!0,productEntity:{},configuratorSettingsRepository:{},groups:[],productEntityLoaded:!1,propertiesAvailable:!0,showAddPropertiesModal:!1,defaultTab:"all",activeTab:"all",configSettingGroups:[],limit:500}},computed:{product(){return Shopware.Store.get("swProductDetail").product},variants(){return Shopware.Store.get("swProductDetail").variants},isStoreLoading(){return Shopware.Store.get("swProductDetail").isLoading},contextLanguageId(){return Shopware.Store.get("context").api.languageId},productRepository(){return this.repositoryFactory.create("product")},groupRepository(){return this.repositoryFactory.create("property_group")},propertyRepository(){return this.repositoryFactory.create("property_group_option")},productProperties(){var t,e;return this.isChild&&((e=(t=this.product)==null?void 0:t.properties)==null?void 0:e.length)<=0?this.parentProduct.properties:this.product.properties},currentProductStates(){return this.activeTab.split(",")},assetFilter(){return Shopware.Filter.getByName("asset")},groupCriteria(){const t=new o(1,this.limit);return t.addFields("name"),t}},watch:{isStoreLoading:{handler(){this.isStoreLoading===!1&&this.loadData()}},contextLanguageId:{handler(){this.$refs.generatedVariants.getList()}}},created(){this.createdComponent()},mounted(){this.mountedComponent()},methods:{createdComponent(){this.checkIfPropertiesExists()},mountedComponent(){this.loadData()},setActiveTab(t){this.activeTab=t},loadData(){this.isStoreLoading||this.loadOptions().then(()=>this.loadGroups()).then(()=>this.loadConfigSettingGroups())},async loadConfigSettingGroups(){const t=u(this.productEntity.configuratorSettings,"option.groupId").map(r=>r.option.groupId),e=h(this.groupCriteria);t.length&&e.addFilter(o.equalsAny("id",t)),this.configSettingGroups=await this.loadAllPropertyGroups(e)},loadOptions(){return new Promise(t=>{const e=new o(1,25);e.addAssociation("configuratorSettings.option"),e.addAssociation("prices"),this.productRepository.get(this.product.id,Shopware.Context.api,e).then(r=>{this.productEntity=r,this.productEntityLoaded=!0,t()})})},loadGroups(){return new Promise(t=>{this.$nextTick().then(async()=>{this.groups=await this.loadAllPropertyGroups(this.groupCriteria),t()})})},updateVariations(){this.$refs.generatedVariants.includeOptions=[],this.$refs.generatedVariants.filterWindowOpen=!1,this.loadOptions().then(()=>this.loadGroups()).then(()=>{this.$refs.generatedVariants.getFilterOptions(),this.$refs.generatedVariants.resetFilterOptions()})},updateVariantListHasContent(t){const e=this.$refs.generatedVariants.includeOptions.length>0,r=this.$route.query?this.$route.query.term:"";this.variantListHasContent=t.length>0||r||e,this.isLoading=!1},openModal(t){this.activeModal=t},onConfigurationClosed(){this.loadData(),this.activeModal=""},checkIfPropertiesExists(){this.propertyRepository.search(new o(1,1)).then(t=>{this.propertiesAvailable=t.total>0})},openAddPropertiesModal(){this.propertiesAvailable?(this.updateNewProperties(),this.showAddPropertiesModal=!0):this.$router.push({name:"sw.property.index"})},closeAddPropertiesModal(){this.showAddPropertiesModal=!1,this.updateNewProperties()},updateNewProperties(){this.newProperties=new l(this.productProperties.source,this.productProperties.entity,this.productProperties.context,o.fromCriteria(this.productProperties.criteria),this.productProperties,this.productProperties.total,this.productProperties.aggregations)},onCancelAddPropertiesModal(){this.closeAddPropertiesModal()},onSaveAddPropertiesModal(t){this.closeAddPropertiesModal(),!(t.length<=0)&&this.productProperties.splice(0,this.productProperties.length,...t)},async loadAllPropertyGroups(t){const e=await this.groupRepository.search(t),r=e.total,i=e.length,n=Math.ceil(r/i),s=[];for(let a=2;a<=n;a++){const p=new o(a,i);s.push(this.groupRepository.search(p))}const d=await Promise.all(s);return[e,...d].flatMap(a=>a)}}};export{g as default};
