var x=Object.defineProperty;var A=(e,t,r)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var l=(e,t,r)=>A(e,typeof t!="symbol"?t+"":t,r);import{u as C,E as I,aU as M,aV as R,aW as T,aX as W,M as p,aY as G,aZ as b,e as L,C as N,a_ as V}from"./channel-DB_OaefQ.js";class j{constructor({code:t,meta:r={},status:n="",detail:g=""}={}){l(this,"selfLink");l(this,"_id");l(this,"_code");l(this,"_parameters");l(this,"_status");l(this,"_detail");l(this,"_trace");if(typeof t!="string"||t==="")throw new Error("[ShopwareError] can not identify error by code");this._id=C.createId(),this._code=t,this._parameters=r.parameters,this._status=n,this._detail=g}get id(){return this._id}get code(){return this._code}set code(t){this._code=t}get parameters(){return this._parameters}set parameters(t){this._parameters=t}get status(){return this._status}set status(t){this._status=t}get detail(){return this._detail}set detail(t){this._trace=t}}M((e,t,r)=>{Shopware.Application.view.setReactive(e,t,r)});function k(e){return(t,r,n)=>(e==="datasetSubscribe"&&T("datasetSubscribeRegistration",{id:t,selectors:n==null?void 0:n.selectors}),W(e,a=>{var o;if((a==null?void 0:a.id)!==t||a.selectors&&a.selectors.length>0&&((o=n==null?void 0:n.selectors)===null||o===void 0?void 0:o.sort().join(","))!==a.selectors.sort().join(","))return;(a==null?void 0:a.data)instanceof p&&console.error(a.data);const f=r(a);f&&f.catch(()=>{})}))}const $=R,F=k("datasetUpdate"),H=G("datasetGet");let h=[],_=[];function m(e){return b.cloneDeepWith(e,t=>{if(t!=null&&t.__identifier__&&typeof t.__identifier__=="function"&&t.__identifier__()==="EntityCollection")return new L(t.source,t.entity,{},t.criteria===null?t.criteria:N.fromCriteria(t.criteria),m(Array.from(t)),t.total,t.aggregations);if(t!=null&&t.__identifier__&&typeof t.__identifier__=="function"&&t.__identifier__()==="Entity")return new I(t.id,t._entityName,m(t._draft),{originData:m(t._origin),isDirty:t._isDirty,isNew:t._isNew})})}H((e,t)=>{var f;const r=(f=t==null?void 0:t._event_)==null?void 0:f.origin,n=h.find(w=>w.id===e.id);if(!n)return null;if(n.deprecated){const w=Object.values(Shopware.Store.get("extensions").extensionsState).find(i=>i.baseUrl.startsWith(t._event_.origin));if(!w)throw new Error(`Extension with the origin "${t._event_.origin}" not found.`);const y=["CORE",`The extension "${w.name}" uses a deprecated data set "${e.id}". ${n.deprecationMessage}`];Shopware.Utils.debug.warn(...y)}const g=e.selectors;if(!g)return n.data;const a=m(n.data),o=V(a,g,"datasetGet",r);return o instanceof p&&console.error(o),o});function X(e){if(!e.includes("."))return null;const t=e.split("."),r=t.pop(),n=t.join(".");return r&&r.length&&n&&n.length?{pathToLastSegment:n,lastSegment:r}:null}function q({id:e,path:t,scope:r,deprecated:n,deprecationMessage:g,showDoubleRegistrationError:a=!0}){var w,y;_.includes(e)&&(_=_.filter(i=>i!==e));const o=h.find(i=>i.id===e);if(o&&o.scope!==((w=r==null?void 0:r.$)==null?void 0:w.uid))return a&&console.error(`The dataset id "${e}" you tried to publish is already registered.`),()=>{};if(o&&o.scope===((y=r==null?void 0:r.$)==null?void 0:y.uid))return $({id:e,data:b.get(r,t)}).catch(()=>{}),()=>{};F(e,i=>{var S;if(!i)return;function u(s,c=null){typeof(s==null?void 0:s.getIsDirty)=="function"&&!s.getIsDirty()||Object.keys(s).forEach(d=>{let D;c?D=`${c}.${d}`:D=`${t}.${d}`;const E=X(D);if(E!==null){if(Shopware.Utils.hasOwnProperty(s[d],"getDraft",this)&&typeof s[d].getDraft=="function"){u({[d]:Shopware.Utils.object.cloneDeep(s[d])},D);return}if(Array.isArray(s[d])){s[d].forEach((P,U)=>{u({[U]:P},D)});return}Shopware.Utils.object.get(r,E.pathToLastSegment)[E.lastSegment]=s[d]}})}if(typeof((S=i.data)==null?void 0:S.getDraft)=="function"){u(i.data);return}if(Array.isArray(i.data))i.data.forEach((s,c)=>{s===null||typeof s!="object"||u({[c]:s})});else if(typeof i.data=="object"){u(i.data);return}if(t.includes(".")){const s=t.split("."),c=s.pop(),d=s.join(".");if(!c)return;Shopware.Utils.object.get(r,d)[c]=i.data;return}r[t]=i.data});const f=r.$watch(t,b.debounce(i=>{var s;if(_.includes(e)){_=_.filter(c=>c!==e),f();return}const u=m(i);$({id:e,data:u}).catch(()=>{});const S=h.find(c=>c.id===e);if(S){S.data=i;return}h.push({id:e,data:u,scope:(s=r==null?void 0:r.$)==null?void 0:s.uid,deprecated:n,deprecationMessage:g})},750),{deep:!0,immediate:!0});return r.dataSetUnwatchers.push(()=>{h=h.filter(i=>i.id!==e),_.push(e),f()}),$({id:e,data:b.get(r,t)}).catch(()=>{}),function(){h=h.filter(u=>u.id!==e),_.push(e),f()}}function z(){return h}export{j as S,m as d,z as g,q as p};
