import{aT as x,u as C}from"./channel-DB_OaefQ.js";import{A as I}from"./api.service-C8jZavFF.js";import{L as d,P as u}from"./order.types-BvKP5qzO.js";class m extends I{constructor(t,e,s="cart"){super(t,e,s),this.name="cartStoreService"}mapLineItemTypeToPriceType(t){return{[d.PRODUCT]:u.QUANTITY,[d.CUSTOM]:u.QUANTITY,[d.CREDIT]:u.ABSOLUTE}[t]}createCart(t,e={},s={}){return this.getCart(t,null,e,s)}getCart(t,e,s={},i={}){const r=`_proxy/store-api/${t}/checkout/cart`,n=this.getBasicHeaders({...i});return e&&(n["sw-context-token"]=e),this.httpClient.get(r,{...s,headers:n})}cancelCart(t,e,s={},i={}){const r=`_proxy/store-api/${t}/checkout/cart`,n=this.getBasicHeaders({...i,"sw-context-token":e});return this.httpClient.delete(r,{...s,headers:n})}removeLineItems(t,e,s,i={},r={}){const n=`_proxy/store-api/${t}/checkout/cart/line-item`,a=this.getBasicHeaders({...r,"sw-context-token":e});return this.httpClient.delete(n,{...i,headers:a,data:{ids:s}})}getRouteForItem(t,e){return`_proxy/store-api/${e}/checkout/cart/line-item`}shouldPriceUpdated(t,e){var a,c,o,p,l,h,y;const s=((a=t.price)==null?void 0:a.unitPrice)!==t.priceDefinition.price,i=(((p=(o=(c=t.price)==null?void 0:c.taxRules)==null?void 0:o[0])==null?void 0:p.taxRate)??null)!==(((y=(h=(l=t.priceDefinition)==null?void 0:l.taxRules)==null?void 0:h[0])==null?void 0:y.taxRate)??null),r=t.type===d.CUSTOM;return!!(!e&&s||i||r&&!s)}getPayloadForItem(t,e,s,i){let r=null;return this.shouldPriceUpdated(t,s)&&(r=x(t.priceDefinition),r.taxRules=t.priceDefinition.taxRules,r.quantity=t.quantity,r.type=this.mapLineItemTypeToPriceType(t.type)),{items:[{id:i,referencedId:i,label:t.label,quantity:t.quantity,type:t.type,description:t.description,priceDefinition:r,stackable:!0,removable:!0,salesChannelId:e}]}}saveLineItem(t,e,s,i={},r={}){const n=s._isNew&&s.type===d.PRODUCT,a=s.identifier||s.id||C.createId(),c=this.getRouteForItem(a,t),o={...this.getBasicHeaders(r),"sw-context-token":e},p=this.getPayloadForItem(s,t,n,a);return s._isNew?this.httpClient.post(c,p,{...i,headers:o}):this.httpClient.patch(c,p,{...i,headers:o})}addPromotionCode(t,e,s,i={},r={}){const n=`_proxy/store-api/${t}/checkout/cart/line-item`,a={...this.getBasicHeaders(r),"sw-context-token":e},c={items:[{type:d.PROMOTION,referencedId:s}]};return this.httpClient.post(n,c,{...i,headers:a})}modifyShippingCosts(t,e,s,i={},r={}){const n="_proxy/modify-shipping-costs",a={...this.getBasicHeaders(i),"sw-context-token":e};return this.httpClient.patch(n,{salesChannelId:t,shippingCosts:s},{...r,headers:a})}disableAutomaticPromotions(t,e={salesChannelId:null},s={}){const i="_proxy/disable-automatic-promotions",r={...this.getBasicHeaders(s),"sw-context-token":t},n={salesChannelId:e.salesChannelId};return this.httpClient.patch(i,n,{...e,headers:r})}enableAutomaticPromotions(t,e={salesChannelId:null},s={}){const i="_proxy/enable-automatic-promotions",r={...this.getBasicHeaders(s),"sw-context-token":t},n={salesChannelId:e.salesChannelId};return this.httpClient.patch(i,n,{...e,headers:r})}addMultipleLineItems(t,e,s,i={},r={}){const n=`_proxy/store-api/${t}/checkout/cart/line-item`,a={...this.getBasicHeaders(r),"sw-context-token":e},c=s.map(o=>{if(o.type===d.PROMOTION)return o;const p=o.identifier||o.id||C.createId();return{id:p,referencedId:p,label:o.label,quantity:o.quantity,type:o.type,description:o.description,priceDefinition:o.type===d.PRODUCT?null:o.priceDefinition,stackable:!0,removable:!0,salesChannelId:t}});return this.httpClient.post(n,{items:c},{...i,headers:a})}}export{m as default};
