var o=Object.defineProperty;var c=(t,e,r)=>e in t?o(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var i=(t,e,r)=>c(t,typeof e!="symbol"?e+"":e,r);const{Context:s,Data:u,Service:a}=Shopware,{Criteria:n}=u;class h{constructor(){i(this,"userConfigRepository",a("repositoryFactory").create("user_config"));i(this,"currentUserId",this.getCurrentUserId());i(this,"userConfig",this.createUserConfigEntity(this.getConfigurationKey()));i(this,"aclService",a("acl"));this.readUserConfig()}refresh(){this.userConfig=this.createUserConfigEntity(this.getConfigurationKey()),this.readUserConfig()}async getUserConfig(){if(!this.aclService.can("user_config:read"))return this.userConfig;const r=(await this.userConfigRepository.search(this.getCriteria(this.getConfigurationKey()),s.api)).first()||this.userConfig;return this.handleEmptyUserConfig(r)}async saveUserConfig(){!this.aclService.can("user_config:create")||!this.aclService.can("user_config:update")||(this.setUserConfig(),await this.userConfigRepository.save(this.userConfig,s.api),await this.readUserConfig())}createUserConfigEntity(e){const r=this.userConfigRepository.create(s.api);if(!r)throw new Error("Could not create user config entity");return Object.assign(r,{userId:this.currentUserId,key:e,value:[]}),r}handleEmptyUserConfig(e){return Array.isArray(e==null?void 0:e.value)||(e.value=[]),e}getCriteria(e){const r=new n(1,25);return r.addFilter(n.equals("key",e)),r.addFilter(n.equals("userId",this.currentUserId)),r}getCurrentUserId(){var e;return((e=Shopware.Store.get("session").currentUser)==null?void 0:e.id)??""}}export{h as U};
