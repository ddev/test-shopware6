import{bm as I,b7 as L,b4 as P,bc as A,a as D}from"./channel-DB_OaefQ.js";var u,v;function E(){if(v)return u;v=1;var e=Math.floor,t=Math.random;function r(a,l){return a+e(t()*(l-a+1))}return u=r,u}var m,b;function R(){if(b)return m;b=1;var e=E();function t(r,a){var l=-1,i=r.length,o=i-1;for(a=a===void 0?i:a;++l<a;){var n=e(l,o),c=r[n];r[n]=r[l],r[l]=c}return r.length=a,r}return m=t,m}var p,g;function $(){if(g)return p;g=1;var e=I(),t=R();function r(a){return t(e(a))}return p=r,p}var h,y;function M(){if(y)return h;y=1;var e=L();function t(r,a){return e(a,function(l){return r[l]})}return h=t,h}var f,C;function T(){if(C)return f;C=1;var e=M(),t=P();function r(a){return a==null?[]:e(a,t(a))}return f=r,f}var _,S;function N(){if(S)return _;S=1;var e=R(),t=T();function r(a){return e(t(a))}return _=r,_}var w,k;function V(){if(k)return w;k=1;var e=$(),t=N(),r=A();function a(l){var i=r(l)?e:t;return i(l)}return w=a,w}var x=V();const O=D(x),B=`{% block sw_product_stream_modal_preview %} <sw-modal class="sw-product-stream-modal-preview" :title="\`\${$tc('sw-product-stream.previewModal.title')} (\${total || 0})\`" :is-loading="isLoading" variant="full" @modal-close="closeModal" > {% block sw_product_stream_modal_preview_content %} <div class="sw-product-stream-modal-preview__content"> {% block sw_product_stream_modal_preview_content_header %} <sw-container class="sw-product-stream-modal-preview__content-header"> {% block sw_product_stream_modal_preview_search_field_label %} <sw-label class="sw-product-stream-modal-preview__search-field-label"> {% block sw_product_stream_modal_preview_search_field %} <sw-simple-search-field class="sw-product-stream-modal-preview__search-field" variant="form" :value="searchTerm" :delay="750" @search-term-change="onSearchTermChange" /> {% endblock %} </sw-label> {% endblock %} {% block sw_product_stream_modal_preview_sales_channel_field_label %} <sw-label class="sw-product-stream-modal-preview__sales-channel-field-label"> {% block sw_product_stream_modal_preview_sales_channel_field %} <sw-entity-single-select v-model:value="selectedSalesChannel" entity="sales_channel" class="sw-product-stream-modal-preview__sales-channel-field" name="sw-field--selectedSalesChannel" :criteria="previewSelectionCriteria" :disabled="isLoading" :label="$tc('sw-settings.system-config.labelSalesChannelSelect')" @update:value="onSalesChannelChange" /> {% endblock %} </sw-label> {% endblock %} </sw-container> {% endblock %} {% block sw_product_stream_modal_preview_grid %} <sw-data-grid v-if="total" :data-source="products" :columns="productColumns" :show-selection="false" :show-actions="false" :show-previews="true" :is-loading="isLoading" full-page > <template #column-name="{ item, column }"> {% block sw_product_stream_modal_preview_grid_column_name %} <router-link :to="{ name: column.routerLink, params: { id: item.id } }"> <sw-product-variant-info :variations="item.variation"> {{ item.name || item.translated.name }} </sw-product-variant-info> </router-link> {% endblock %} </template> <template #column-active="{ item }"> {% block sw_product_stream_modal_preview_grid_column_active %} <sw-data-grid-column-boolean :value="item.active" :is-inline-edit="false" /> {% endblock %} </template> <template #column-price="{ item }"> {% block sw_product_stream_modal_preview_grid_column_price %} {{ currencyFilter(getPriceForDefaultCurrency(item).unitPrice, selectedCurrencyIsoCode) }} {% endblock %} </template> <template #column-stock="{ item }"> {% block sw_product_stream_modal_preview_grid_column_stock %} {{ item.stock }} <sw-color-badge :variant="stockColorVariantFilter(item.stock)" /> {% endblock %} </template> <template #pagination> {% block sw_product_stream_modal_preview_grid_pagination %} <sw-pagination v-bind="{ total, page, limit }" :total-visible="7" :auto-hide="false" @page-change="onPageChange" /> {% endblock %} </template> </sw-data-grid> {% endblock %} {% block sw_product_stream_modal_preview_empty_state %} <mt-empty-state v-if="!total && !isLoading" :icon="$route.meta.$module.icon" :headline="$tc('sw-product-stream.previewModal.empty')" /> {% endblock %} </div> {% endblock %} {% block sw_product_stream_modal_preview_footer %} <template #modal-footer> {% block sw_product_stream_modal_preview_close_button %} <mt-button class="sw-product-stream-modal-preview__close-action" variant="primary" @click.prevent="closeModal" > {{ $tc('sw-product-stream.previewModal.close') }} </mt-button> {% endblock %} </template> {% endblock %} </sw-modal> {% endblock %}`,{Context:U}=Shopware,{Criteria:s}=Shopware.Data,q="ed535e5722134ac1aa6524f73e26881b",K={template:B,inject:["repositoryFactory","productStreamPreviewService"],emits:["modal-close"],props:{filters:{type:Array,required:!0},defaultLimit:{type:Number,default:25},defaultSorting:{type:String,default:null,validator(e){return e===null||e.split(":").length===2}}},data(){return{products:[],selectedSalesChannel:null,searchTerm:"",page:1,total:!1,limit:this.defaultLimit,sorting:this.defaultSorting,isLoading:!1,selectedCurrencyIsoCode:"EUR",selectedCurrencyId:U.app.systemCurrencyId}},computed:{salesChannelRepository(){return this.repositoryFactory.create("sales_channel")},salesChannelCriteria(){return new s(1,1).addFilter(s.not("OR",[s.equals("typeId",q)])).addSorting(s.sort("type.iconName","ASC"))},previewCriteria(){const e=new s(this.page,this.limit).setTerm(this.searchTerm);if(this.sorting)if(this.sorting==="random")this.addRandomSort(e);else{const[t,r]=this.sorting.split(":");e.addSorting(s.sort(t,r))}return e},previewSelectionCriteria(){return new s().addFilter(s.not("OR",[s.equals("typeId",q)])).addSorting(s.sort("name","ASC"))},productColumns(){return[{property:"name",label:this.$tc("sw-product-stream.filter.values.product"),type:"text",routerLink:"sw.product.detail"},{property:"manufacturer.name",label:this.$tc("sw-product-stream.filter.values.manufacturerId")},{property:"active",label:this.$tc("sw-product-stream.filter.values.active"),align:"center",type:"bool"},{property:"price",label:this.$tc("sw-product-stream.filter.values.price")},{property:"stock",label:this.$tc("sw-product-stream.filter.values.stock"),align:"right"}]},currencyFilter(){return Shopware.Filter.getByName("currency")},stockColorVariantFilter(){return Shopware.Filter.getByName("stockColorVariant")}},created(){this.createdComponent()},methods:{createdComponent(){return this.isLoading=!0,this.loadSalesChannels().then(()=>this.loadEntityData()).finally(()=>{this.isLoading=!1})},onSearchTermChange(e){this.searchTerm=e,this.page=1,this.isLoading=!0,this.loadEntityData().finally(()=>{this.isLoading=!1})},onSalesChannelChange(){this.page=1,this.isLoading=!0,this.loadSalesChannelById().then(()=>this.loadEntityData()).finally(()=>{this.isLoading=!1})},loadEntityData(){return this.selectedSalesChannel?this.productStreamPreviewService.preview(this.selectedSalesChannel,this.previewCriteria,this.mapFiltersForSearch(this.filters),{"sw-currency-id":this.selectedCurrencyId,"sw-inheritance":!0}).then(e=>{this.products=Object.values(e.elements),this.total=e.total}):!1},loadSalesChannels(){return this.salesChannelRepository.searchIds(this.salesChannelCriteria).then(({data:e})=>{this.selectedSalesChannel=e.at(0)})},mapFiltersForSearch(e=[],t=null){return e.map(r=>{const{field:a,type:l,operator:i,value:o,parameters:n,queries:c}=r,F=this.mapFiltersForSearch(c,l),d={field:a,type:l,operator:i,value:o,parameters:n,queries:F};return a==="id"||a==="product.id"?{type:"multi",field:null,operator:this.isNotEqualToAnyType(l,t)?"AND":"OR",value:null,parameters:null,queries:[d,{...d,field:"parentId"}]}:d})},closeModal(){this.$emit("modal-close")},getPriceForDefaultCurrency(e){const t=e.calculatedCheapestPrice;let r=e.calculatedPrice;return e.calculatedPrices.length>0&&(r=e.calculatedPrices[e.calculatedPrices.length-1]),t.unitPrice!==r.unitPrice?r:t},onPageChange({page:e=1,limit:t=25}){this.isLoading=!0,this.page=e,this.limit=t,this.loadEntityData().finally(()=>{this.isLoading=!1})},loadSalesChannelById(){return this.selectedSalesChannel===null?Promise.resolve():(this.salesChannelCriteria.addAssociation("currency"),this.salesChannelRepository.get(this.selectedSalesChannel,Shopware.Context.api,this.salesChannelCriteria).then(t=>{this.selectedCurrencyIsoCode=t.currency.isoCode,this.selectedCurrencyId=t.currencyId}))},isNotEqualToAnyType(e,t){return e==="equalsAny"&&t==="not"},addRandomSort(e){let t=["name","createdAt","cheapestPrice","releaseDate"];t=O(t);const r=t.slice(0,2),a=["ASC","DESC"],l=a[Math.floor(Math.random()*a.length)];r.forEach(i=>{e.addSorting(s.sort(i,l))})}}};export{K as default};
